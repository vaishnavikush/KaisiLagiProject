<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <title>Create New Admin</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Cookie&family=Monoton&family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet">
  <!-- Cropper.js CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet" />

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      height: 100vh;
      background-image: url("/images/bb.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;

    }

    h1 {
      font-family: monoton;
      word-spacing: 5px;
      font-size: 2rem;
      font-weight: 500;
      color: #fff;
      text-align: center;
      margin-bottom: 10px;
      text-shadow: 1px 1px 2px rgba(211, 211, 211, 0.604);
    }

    h3 {

      font-weight: 700;
      word-spacing: 5px;
      color: #ffffff;
      text-align: center;
      margin-bottom: 30px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
    }

    /* SIDEBAR DESKTOP */
    :root {
      --sidebar-width: 250px;
      --primary-bg: #1d000a;
      --sidebar-bg: rgba(199, 188, 191, 0.21);
      --sidebar-border: #eb2d5d;
    }

    table td,
    table th {
      background: rgba(255, 255, 255, 0.1) !important;
      backdrop-filter: blur(5px);
      color: #ffffff !important;
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
    }

    thead th {
      background: rgba(255, 255, 255, 0.2) !important;
      backdrop-filter: blur(10px);
      color: #ffffff !important;
      font-weight: bold;
    }

    .layout {
      display: flex;
      gap: 18px;
    }

    .sidebar {
      color: #ffffff;
      width: 250px;
      margin-top: 10px;
      background: linear-gradient(145deg, rgba(102, 145, 160, 0.4), rgba(125, 1, 34, 0.522));
      backdrop-filter: blur(10px);
      border-left: 4px solid var(--sidebar-border);
      padding: 20px;
      height: calc(100vh - 100px);
      border-radius: 12px;
      box-shadow: 0 6px 30px rgba(0, 0, 0, 0.4);
      position: sticky;
      top: 100px;
      transition: all 0.3s ease;
    }

    .sidebar nav a {
      display: block;
      padding: 12px 15px;
      margin-bottom: 8px;
      border-radius: 10px;
      color: #ffffff;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .sidebar nav a i {
      margin-right: 8px;
    }

    .sidebar nav a:hover,
    .sidebar nav a.active {
      background: rgba(250, 234, 238, 0.3);
      color: #fff;
      text-shadow: 0 0 8px #ff0080;
      transform: translateX(5px);
    }

    .main-content {
      flex: 1;
      padding: 18px;
      background-color: transparent;
    }

/* Profile Image Styling */
    .sidebar .rounded-circle {
            border: 2px solid var(--accent);
            padding: 2px;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 20px rgba(245, 103, 138, 0.6);
            transition: all 0.4s ease;
        }

        .sidebar .rounded-circle:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 0 30px rgba(235, 45, 93, 1);
        }

        .sidebar h6 {
            color: #ffffff !important;
            text-shadow: 0 2px 15px rgba(235, 45, 93, 0.8);
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 2px 15px rgba(235, 45, 93, 0.8); }
            50% { text-shadow: 0 2px 25px rgba(235, 45, 93, 1); }
        }

    /* Text Colors */
    .text-light {
      color: #ffffff !important;
    }

     /* Mobile Sidebar */
        @media (max-width: 991px) {
            .sidebar {
                position: fixed;
                top: 120px;
                left: 0;
                width: 200px;
                height: calc(100vh - 140px);
                background: linear-gradient(145deg, #7917307b, rgba(106, 11, 36, 0.314));
                backdrop-filter: blur(10px);
                z-index: 9999;
                transform: translateX(-200px);
                transition: transform 0.35s ease;
                border-radius: 0 14px 14px 0;
                box-shadow: 6px 0 20px rgba(0, 0, 0, 0.5);
            }

            /* Thin visible strip */
            .sidebar::after {
                content: "";
                position: absolute;
                top: 0;
                right: -10px;
                width: 10px;
                height: 100%;
                background: linear-gradient(145deg, #79172f, rgba(106, 11, 36, 0.95));
                border-radius: 0 10px 10px 0;
                cursor: pointer;
            }
      /* Open on hover/touch */
      .sidebar:hover,
      .sidebar.open {
        transform: translateX(0);
      }

      .sidebar-strip {
        position: absolute;
        top: 0;
        right: -10px;
        width: 10px;
        height: 100%;
        background: linear-gradient(145deg, #79172f, rgba(106, 11, 36, 0.95));
        border-radius: 0 10px 10px 0;
        cursor: pointer;
      }

      .layout {
        flex-direction: column;
      }

      .main-content {
        padding: 10px;
      }
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      body {
        padding-top: 70px;
      }

      .sidebar {
        top: 90px;
      }
    }

    @media (max-width: 576px) {
      .container-fluid {
        padding: 10px;
      }

      h1 {
        font-size: 1.5rem;
      }

      h3 {
        font-size: 1.2rem;
        margin-bottom: 20px;
      }

      .row.mb-3 .col-md-6 {
        max-width: 100%;
      }

      .search-container .form-control {
        font-size: 0.9rem;
        padding: 8px 12px;
      }

      .table-responsive {
        font-size: 0.8rem;
      }

      .btn-sm {
        padding: 4px 8px;
        font-size: 0.75rem;
      }

      .badge {
        font-size: 0.7rem;
      }
    }

    .glass-bg {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 10px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .glass-bg table {
      background: transparent !important;
      border-collapse: separate;
      border-spacing: 0;
      border-radius: 10px;
    }

    .search-container {
      position: relative;
    }

    .search-container .form-control {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 25px;
      color: #ffffff;
      padding-right: 40px;
    }

    .search-container .form-control::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    .search-icon {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(255, 255, 255, 0.8);
      pointer-events: none;
    }
  </style>
</head>
<!-- NAVBAR -->
<div th:replace="~{fragments/navbar :: nav(activePage='dashboard')}"></div>

<body>
  <div class="layout">
    <!-- SIDEBAR -->
    <aside id="sidebar" class="sidebar mb-3">
        <div class="text-center mb-4" style="display: flex; align-items: center; justify-content: center; gap: 10px;">
            <a th:href="@{/profile}">
                <img th:src="${photo != null} ? 'data:image/jpeg;base64,' + ${photo} : @{/images/default.png}"
                     alt="Profile Picture" width="50" height="50" class="rounded-circle" />
            </a>
            <h6 style="font-family: 'Poppins', sans-serif; color: #ffffff; margin-top: 0;" th:text="${username}">Admin</h6>
            <!-- <h5 style="font-family: 'Cookie', cursive; color: #ffffff; margin-top: 5px;">Kaisi Lagi</h5> -->
        </div>
      <nav>
        <a th:href="@{/dashboard}" th:classappend="${activePage == 'dashboard'} ? 'active' : ''">
          <i class="bi bi-speedometer2"></i> Dashboard
        </a>
        <a th:href="@{/moviedelete}" th:classappend="${activePage == 'moviedelete'} ? 'active' : ''">
          <i class="bi bi-camera-reels-fill"></i> All Movies
        </a>
        <a th:href="@{/showpeople}" th:classappend="${activePage == 'showpeople'} ? 'active' : ''">
          <i class="bi bi-people-fill"></i> All Crew
        </a>
        <a class="active" th:href="@{/users}" th:classappend="${activePage == 'makeAdmin'} ? 'active' : ''">
          <i class="bi bi-person-workspace"></i> Create Admin
        </a>
        <a th:href="@{/block-users}" th:classappend="${activePage == 'blockUser'} ? 'active' : ''">
          <i class="bi bi-person-fill-gear"></i> All Users
        </a>
        <a th:href="@{/ShowReports}" th:classappend="${activePage == 'ShowReports'} ? 'active' : ''">
          <i class="bi bi-bar-chart-fill"></i> All Reports
        </a>
        <a th:href="@{/list}" th:classappend="${activePage == 'badgelist'} ? 'active' : ''">
          <i class="bi bi-award-fill"></i>Badges
        </a>
        <a th:href="@{/logout}">
          <i class="bi bi-box-arrow-right"></i> Logout
        </a>
      </nav>
      <div class="sidebar-strip"></div>
    </aside>
    <div class="container-fluid">

      <!--  <button class="btn btn-warning fw-semibold" onclick="history.back()">-->
      <!--    <i class="bi bi-arrow-left-circle"></i> Back-->
      <!--  </button>-->
      <h1 class="text-light">CREATE ADMIN</h1>
      <h3 class="mb-4 text-light" style="font-family: 'Cookie', cursive;">
        <i class="bi bi-shield-lock-fill text-light"></i> Select User to Make Admin
      </h3>

      <div class="row mb-3">
        <div class="col-md-6 mx-auto">
          <div class="search-container">
            <input type="text" id="userSearch" class="form-control" placeholder="Search by email..."
              onkeyup="filterUsers()">
            <i class="bi bi-search search-icon"></i>
          </div>
        </div>
      </div>

      <div class="table-responsive ">
        <table class="table table-bordered" id="userTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Action</th>
            </tr>
          </thead>

          <tbody>
            <tr th:each="user : ${users}">
              <td th:text="${user.id}"></td>
              <td th:text="${user.username}"></td>
              <td th:text="${user.email}"></td>

              <td>
                <span class="badge bg-secondary "
                  th:if="${user.role != null and user.role.name() == 'USER'}">USER</span>

                <span class="badge bg-success" th:if="${user.role != null and user.role.name() == 'ADMIN'}">ADMIN</span>

              </td>

              <td>
                <!-- Show button only if user is USER -->
                <form th:if="${user.role != null and user.role.name() == 'USER'}"
                  th:action="@{/make-admin/{id}(id=${user.id})}" method="post">

                  <button class="btn btn-sm btn-warning">
                    <i class="bi bi-person-check-fill"></i> Make Admin
                  </button>
                </form>

                <span th:if="${user.role.name() == 'ADMIN'}">â€”</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- Toast -->
      <div class="toast-container position-fixed bottom-0 end-0 p-3">

        <div id="liveToast" class="toast align-items-center text-bg-[[${toastType}]] border-0" role="alert"
          aria-live="assertive" aria-atomic="true" th:if="${toastMsg != null}">

          <div class="d-flex">
            <div class="toast-body" th:text="${toastMsg}">
            </div>

            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
              aria-label="Close">
            </button>
          </div>
        </div>

      </div>
    </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script th:if="${toastMsg != null}">
      const toastEl = document.getElementById('liveToast');
      const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
      toast.show();
    </script>

    <script>
      function filterUsers() {
        let input = document.getElementById("userSearch").value.toLowerCase();
        let table = document.getElementById("userTable");
        let tr = table.getElementsByTagName("tr");

        for (let i = 1; i < tr.length; i++) {  // start from 1 to skip header
          let td = tr[i].getElementsByTagName("td")[2];  // email is 3rd column (index 2)
          if (td) {
            let txtValue = td.textContent || td.innerText;
            if (txtValue.toLowerCase().indexOf(input) > -1) {
              tr[i].style.display = "";
            } else {
              tr[i].style.display = "none";
            }
          }
        }
      }

      // Mobile Sidebar Functionality
      const sidebar = document.getElementById('sidebar');
      const sidebarStrip = document.querySelector('.sidebar-strip');

      function isMobile() {
        return window.innerWidth < 992;
      }

      // Toggle on strip click
      if (sidebarStrip) {
        sidebarStrip.addEventListener('click', function () {
          sidebar.classList.toggle('open');
        });
      }

      // Close when touching outside
      document.addEventListener('touchstart', function (e) {
        if (!isMobile()) return;
        if (!sidebar.contains(e.target) && e.target !== sidebarStrip) {
          sidebar.classList.remove('open');
        }
      });

      // Reset when back to desktop
      window.addEventListener('resize', function () {
        if (!isMobile()) {
          sidebar.classList.remove('open');
        }
      });
    </script>

</body>

</html>